# ğŸ—„ï¸ ç«‹å³æ‰§è¡Œæ•°æ®åº“è¿ç§»

## ğŸ“ æ“ä½œæ­¥éª¤

### 1. ç™»å½• Supabase Dashboard

è®¿é—®ï¼šhttps://supabase.com/dashboard

### 2. é€‰æ‹©ä½ çš„é¡¹ç›®

ç‚¹å‡»ä½ çš„é¡¹ç›®è¿›å…¥

### 3. æ‰“å¼€ SQL Editor

å·¦ä¾§èœå• â†’ **SQL Editor**

### 4. åˆ›å»ºæ–°æŸ¥è¯¢

ç‚¹å‡» **"New query"** æŒ‰é’®

### 5. å¤åˆ¶å¹¶æ‰§è¡Œä»¥ä¸‹ SQL

```sql
-- åˆ›å»ºä¸´æ—¶æ³¨å†Œè¡¨
CREATE TABLE IF NOT EXISTS pending_registrations (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  scene_id VARCHAR(64) UNIQUE NOT NULL,
  email VARCHAR(255) NOT NULL,
  password_hash TEXT NOT NULL,
  nickname VARCHAR(100),
  wechat_openid VARCHAR(100),
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT NOW(),
  expires_at TIMESTAMP DEFAULT NOW() + INTERVAL '30 minutes',
  completed_at TIMESTAMP,
  
  CONSTRAINT check_status CHECK (status IN ('pending', 'completed', 'expired', 'failed'))
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_pending_scene_id ON pending_registrations(scene_id);
CREATE INDEX IF NOT EXISTS idx_pending_status ON pending_registrations(status);
CREATE INDEX IF NOT EXISTS idx_pending_expires_at ON pending_registrations(expires_at);
CREATE INDEX IF NOT EXISTS idx_pending_wechat_openid ON pending_registrations(wechat_openid);

-- ç”¨æˆ·è¡¨æ·»åŠ å¾®ä¿¡ openid å­—æ®µ
ALTER TABLE users ADD COLUMN IF NOT EXISTS wechat_openid VARCHAR(100) UNIQUE;
CREATE INDEX IF NOT EXISTS idx_users_wechat_openid ON users(wechat_openid);

-- æ·»åŠ æ³¨é‡Š
COMMENT ON TABLE pending_registrations IS 'ä¸´æ—¶æ³¨å†Œè¡¨ï¼Œç”¨äºå¾®ä¿¡å…¬ä¼—å·æ³¨å†ŒéªŒè¯';
COMMENT ON COLUMN pending_registrations.scene_id IS 'äºŒç»´ç åœºæ™¯å€¼';
COMMENT ON COLUMN pending_registrations.wechat_openid IS 'å¾®ä¿¡ç”¨æˆ· OpenID';
COMMENT ON COLUMN pending_registrations.status IS 'çŠ¶æ€ï¼špending-ç­‰å¾…ä¸­, completed-å·²å®Œæˆ, expired-å·²è¿‡æœŸ, failed-å¤±è´¥';
```

### 6. ç‚¹å‡» "Run" æŒ‰é’®

æ‰§è¡Œ SQL è„šæœ¬

### 7. éªŒè¯æˆåŠŸ

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… Success. No rows returned

### 8. æ£€æŸ¥è¡¨æ˜¯å¦åˆ›å»º

å·¦ä¾§èœå• â†’ **Table Editor**

åº”è¯¥èƒ½çœ‹åˆ°ï¼š
- `pending_registrations` è¡¨
- `users` è¡¨ä¸­æœ‰ `wechat_openid` å­—æ®µ

## âœ… å®Œæˆåå‘Šè¯‰æˆ‘

æ‰§è¡ŒæˆåŠŸåï¼Œå›å¤ï¼š
```
âœ… æ•°æ®åº“è¿ç§»å®Œæˆ
```

ç„¶åæˆ‘ä¼šç»§ç»­é…ç½®ç¯å¢ƒå˜é‡å’Œéƒ¨ç½²ä»£ç ã€‚

---

**é‡åˆ°é—®é¢˜ï¼Ÿ** æˆªå›¾ç»™æˆ‘ï¼Œæˆ‘ä¼šå¸®ä½ è§£å†³ï¼
